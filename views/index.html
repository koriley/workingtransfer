<!doctype html>
<html class="no-js" lang="en" dir="ltr">

<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Foundation for Sites</title>
    <link rel="stylesheet" href="./css/foundation.css">
    <link rel="stylesheet" href="./css/main.css">
</head>

<body>

    <div class="topBar" style="">
        <div class="topBarContainer" style="">
            <div class="close" style=""></div>
            <div class="min" style=""></div>
            <div class="max" style=""></div>

        </div>
    </div>

    <div class="topSpace" style="height:25px;"></div>

    <div class="expanded row">
        <div class="medium-3 large-2 columns menuColumn fullHeight">
            <ul class="create">
                <li class="creator text-center">
                    <h3 data-open="creator">Create Project</h3>
                </li>
                <hr />
            </ul>
            <ul class=" vertical menu projects">

            </ul>
        </div>

        <div class="medium-9 large-10 columns mother fullHeight">
            asddasf
            <div class="list">

            </div>
        </div>
    </div>



    <!-- create project Modal -->
    <div class="tiny reveal" id="creator" data-reveal>
        <form>
            <div class="row">
                <div class="medium-12 large-12 columns">
                    <label id="proName">Name of Project
        <input type="text" name="projectName" placeholder="">
      </label>


                    <label id="proUrl">URL for project
        <input type="text" name="projectUrl" placeholder="">
      </label>

                </div>
        </form>
        <button class="close-button" data-close aria-label="Close modal" type="button">
    <span aria-hidden="true">&times;</span>
  </button>
        <div class="text-right" style="width:100%;">
            <button class="button glow projectCreate" type="button">
      SAVE
    </button>
        </div>

        </div>



        <script src="./js/jquery-3.1.1.min.js" type="text/javascript" onload="window.$ = window.jQuery = module.exports;"></script>
        <script src="./js/what-input.js"></script>
        <script src="./js/foundation.min.js"></script>

</body>
<script type="text/javascript">
    $(document).foundation();

    function getWidthHeight() {
        var width = jQuery(window).width();
        var height = jQuery(window).height();
        jQuery('.width').html(width + 'x' + height);
    }
    //  getWidthHeight();
    function fullHeight() {
        var height = jQuery(window).height();
        jQuery('.fullHeight').height(height - 25);
    }
    fullHeight();
    jQuery(window).resize(() => {
        //  getWidthHeight();
        fullHeight();
    });

    jQuery(".projectCreate").on("click", function() {

        readAFile("./projects/projects-all.json").then((project) => {
          if(project !=''){
//console.log("ifProject");
            var proObj = JSON.parse(project);
          }
            var newHtml = [];
            var newArray = [];
            var newObject = {};
            //console.log(proObj.menu.length);
            var name = jQuery('input[name=projectName]').val();
            var url = jQuery('input[name=projectUrl]').val();

            //console.log(name);
            if (!name) {
                jQuery('#proName').addClass('error');
                return;
            } else if (!url) {
                jQuery('#proUrl').addClass('error');
                return;
            }
            if(proObj){
//console.log("ifporObj");
            var arrayLength = proObj.menu.length - 1;
          }else{
            arrayLength = -1;
          //  console.log("here");
          }
          //console.log(arrayLength);
            if (arrayLength>=0) {
            //  console.log("for");
                for (var i = 0; i <= arrayLength; i++) {
                    newHtml.push('<li>' + proObj.menu[i].name + '</li>');
                    newArray.push({
                        "name": proObj.menu[i].name,
                        "url": proObj.menu[i].url
                    });
                }
            }
            newArray.push({
                "name": name,
                "url": url
            });
            newHtml.push('<li>' + name + '</li>');
            //console.log(newArray);
            writeObj = {
                "menu": newArray
            }
            JSON.stringify(writeObj, undefined, 2);
          //  console.log(writeObj);
            jQuery('.list').html(JSON.stringify(writeObj, undefined, 2));

            writeFile("./projects/projects-all.json", JSON.stringify(writeObj, undefined, 2)).then((reply) => {
                if (error) {
                    alert(error);
                    return;
                }

            }, (errorMessage) => {
                console.log(errorMessage);
            });
            jQuery('.projects').html(newHtml);
            jQuery('#proName').removeClass('error');
            jQuery('#proUrl').removeClass('error');
            jQuery('input[name=projectName]').val('');
            jQuery('input[name=projectUrl]').val('');
            jQuery('#creator').foundation('close');
            return;


        }, (errorMessage) => {
            console.log(errorMessage);
        });

    });

    var app = require('electron').remote;
    var dialog = app.dialog;
    var fs = require('fs');

    //stop light functions
    jQuery(".min").on("click", function(e) {
        var window = app.getCurrentWindow();
        window.minimize();
    });

    jQuery(".max").on("click", function(e) {
        var window = app.getCurrentWindow();
        if (!window.isMaximized()) {
            window.maximize();
        } else {
            window.unmaximize();
        }
    });

    jQuery(".close").on("click", function(e) {
        var window = app.getCurrentWindow();
        window.close();
    });

    // function readFile(filepath) {
    //     var data;
    //     fs.readFile(filepath, 'utf-8', function(err, data) {
    //         if (err) {
    //             alert("An error ocurred reading the file :" + err.message);
    //             return;
    //         }
    //         // Change how to handle the file content
    //         // console.log("The file content is : " + data);
    //         return data;
    //     });
    //
    // }

    var readAFile = (filepath) => {
        return new Promise((resolve, reject) => {
            fs.readFile(filepath, 'utf-8', function(err, data) {
                if (err) {
                    reject("An error ocurred reading the file :" + err.message);
                    return;
                } else {
                    resolve(data);
                }
            });
        });
    }

    var writeFile = (filepath, data) => {
        return new Promise((resolve, reject) => {
          fs.writeFile(filepath, data, (err) => {
              if (err) {
                  reject(err);
              }
          });
        })
    }

    readAFile("./projects/projects-all.json").then((project) => {
      if(project!=''){
        //console.log("readin file at start");
        var proObj = JSON.parse(project);
        //console.log(proObj);
        var newHtml = [];
        //console.log(proObj.menu.length);
        var length = proObj.menu.length - 1;

//console.log(length);
        for (var i = 0; i <= length; i++) {
            newHtml.push('<li>' + proObj.menu[i].name + '</li>');
        }
      }

        //console.log(proObj.menu[0].name)
        jQuery('.projects').html(newHtml);

    }, (errorMessage) => {
        console.log(errorMessage);
    });

    //var projects = readFile("./projects/projects-all.json");



    // onload="window.$ = window.jQuery = module.exports;"
    ///
</script>

</html>
